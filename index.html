<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BubbleWrap - A Cocoa wrapper by Matt Aimonetti</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-30927742-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();

     </script>
   </head>
   <body>
     <div class="wrapper">
       <header>
         <h1>BubbleWrap</h1>
         <p>
           Cocoa wrappers and helpers for <a href="http://www.rubymotion.com/">RubyMotion</a>.
         </p>
         <p class="view">
           <a href="https://github.com/rubymotion/BubbleWrap">View the Project on GitHub <small>rubymotion/BubbleWrap</small></a>
           <a href="http://rdoc.info/github/rubymotion/BubbleWrap/master/frames">Read the RDoc<small>rdoc.info</small></a>
           <a href="http://rubygems.org/gems/bubble-wrap">Get the Ruby Gem<small>gem 'bubble-wrap'</small></a>
           <a href="https://groups.google.com/d/forum/bubblewrap">Join the discussion<small>bubblewrap@googlegroups.com</small></a>
           <a href="getting_started.html">Using BubbleWrap<small>A guide to getting started with BubbleWrap</small></a>
           <a href="hacking.html">Hacking BubbleWrap<small>A guide to working on BubbleWrap</small></a>
           <a href="gem.html">Gem Howto<small>Building RubyMotion gems with BW</small></a>
         </p>
       </header>
       <section>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1>BubbleWrap for RubyMotion</h1>

<p>A collection of (tested) helpers and wrappers used to wrap CocoaTouch code and provide more Ruby like APIs.</p>

<p><a href="http://bubblewrap.io">BubbleWrap website</a>
<a href="https://groups.google.com/forum/#!forum/bubblewrap">BubbleWrap mailing list</a></p>

<h2>Installation</h2>

<div class="highlight">
<pre><span class="n">gem</span> <span class="n">install</span> <span class="n">bubble</span><span class="o">-</span><span class="n">wrap</span>
</pre>
</div>


<h2>Setup</h2>

<ol>
<li>Edit the <code>Rakefile</code> of your RubyMotion project and add the following require line:</li>
</ol>
<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap'</span>
</pre>
</div>


<p>BubbleWrap is split into multiple modules so that you can easily choose which parts
are included at compile-time.</p>

<p>The above example requires the <code>core</code> and <code>http</code> modules. If you wish to only
include the core modules use the following line of code instead:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/core'</span>
</pre>
</div>


<p>If you wish to only include the <code>HTTP</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/http'</span>
</pre>
</div>


<p>If you wish to only include the <code>RSS Parser</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/rss_parser'</span>
</pre>
</div>


<p>If you wish to only include the <code>Reactor</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/reactor'</span>
</pre>
</div>


<p>If you want to include everything (ie kitchen sink mode) you can save time and do:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/all'</span>
</pre>
</div>


<p>Note: <strong>DON'T</strong> use <code>app.files =</code> in your Rakefile to set up your files once you've required BubbleWrap.
Make sure to append onto the array or use <code>+=</code>.</p>

<ol>
<li>Now, you can use BubbleWrap extension in your app:</li>
</ol>
<div class="highlight">
<pre><span class="k">class</span> <span class="nc">AppDelegate</span>
  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="no">App</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="no">App</span><span class="o">.</span><span class="n">documents_path</span><span class="si">}</span><span class="s2">)"</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<p>Note: You can also vendor this repository but the recommended way is to
use the versioned gem.</p>

<h2>Core</h2>

<h3>App</h3>

<p>A module with useful methods related to the running application</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">documents_path</span>
<span class="c1"># "/Users/mattetti/Library/Application Support/iPhone Simulator/5.0/Applications/EEC6454E-1816-451E-BB9A-EE18222E1A8F/Documents"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">resources_path</span>
<span class="c1"># "/Users/mattetti/Library/Application Support/iPhone Simulator/5.0/Applications/EEC6454E-1816-451E-BB9A-EE18222E1A8F/testSuite_spec.app"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># "testSuite"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">identifier</span>
<span class="c1"># "io.bubblewrap.testSuite"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="s2">"BubbleWrap is awesome!"</span><span class="p">)</span>
<span class="c1"># creates and shows an alert message.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">run_after</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>  <span class="nb">p</span> <span class="s2">"It's </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">"</span>   <span class="p">}</span>
<span class="c1"># Runs the block after 0.5 seconds.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="s2">"http://matt.aimonetti.net"</span><span class="p">)</span>
<span class="c1"># Opens the url using the device's browser. (accepts a string url or an instance of `NSURL`.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="c1"># application specific persistence storage</span>
<span class="c1"># ['NBC', 'ABC', 'Fox', 'CBS', 'PBS']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'TF1'</span><span class="p">,</span> <span class="s1">'France 2'</span><span class="p">,</span> <span class="s1">'France 3'</span><span class="o">]</span>
<span class="c1"># ['TF1', 'France 2', 'France 3']</span>
</pre>
</div>


<p>Other available methods:</p>

<ul>
<li><code>App.notification_center</code></li>
<li><code>App.user_cache</code></li>
<li><code>App.states</code></li>
<li><code>App.frame</code></li>
<li><code>App.delegate</code></li>
<li><code>App.current_locale</code></li>
</ul>
<h3>Device</h3>

<p>A collection of useful methods about the current device:</p>

<p>Examples:</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">iphone?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">ipad?</span>
<span class="c1"># false</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">front_camera?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">rear_camera?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">orientation</span>
<span class="c1"># :portrait</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">simulator?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">retina?</span>
<span class="c1"># false</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">width</span>
<span class="c1"># 320</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">height</span>
<span class="c1"># 480</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">width_for_orientation</span><span class="p">(</span><span class="ss">:landscape_left</span><span class="p">)</span>
<span class="c1"># 480</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">height_for_orientation</span><span class="p">(</span><span class="ss">:landscape_left</span><span class="p">)</span>
<span class="c1"># 320</span>
</pre>
</div>


<h3>Gestures</h3>

<p>Extra methods on <code>UIView</code> for working with gesture recognizers. A gesture recognizer can be added using a normal Ruby block, like so:</p>

<div class="highlight">
<pre>    <span class="n">view</span><span class="o">.</span><span class="n">whenTapped</span> <span class="k">do</span>
      <span class="no">UIView</span><span class="o">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">animations</span><span class="ss">:lambda</span> <span class="p">{</span>
          <span class="c1"># animate</span>
          <span class="c1"># @view.transform = ...</span>
        <span class="p">})</span>
    <span class="k">end</span>
</pre>
</div>


<p>There are similar methods for pinched, rotated, swiped, panned, and pressed (for long presses). All of the methods return the actual recognizer object, so it is possible to set the delegate if more fine-grained control is needed.</p>

<h3>JSON</h3>

<p><code>BubbleWrap::JSON</code> wraps <code>NSJSONSerialization</code> available in iOS5 and offers the same API as Ruby's JSON std lib.</p>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">JSON</span><span class="o">.</span><span class="n">generate</span><span class="p">({</span><span class="s1">'foo =&gt; 1, '</span><span class="n">bar</span><span class="s1">' =&gt; [1,2,3], '</span><span class="n">baz</span> <span class="o">=&gt;</span> <span class="s1">'awesome'</span><span class="p">})</span>
<span class="o">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">foo</span><span class="se">\"</span><span class="s2">:1,</span><span class="se">\"</span><span class="s2">bar</span><span class="se">\"</span><span class="s2">:[1,2,3],</span><span class="se">\"</span><span class="s2">baz</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">awesome</span><span class="se">\"</span><span class="s2">}"</span>
<span class="no">BW</span><span class="o">::</span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">foo</span><span class="se">\"</span><span class="s2">:1,</span><span class="se">\"</span><span class="s2">bar</span><span class="se">\"</span><span class="s2">:[1,2,3],</span><span class="se">\"</span><span class="s2">baz</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">awesome</span><span class="se">\"</span><span class="s2">}"</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"foo"</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span><span class="o">=&gt;[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="s2">"baz"</span><span class="o">=&gt;</span><span class="s2">"awesome"</span><span class="p">}</span>
</pre>
</div>


<h3>NSIndexPath</h3>

<p>Helper methods added to give <code>NSIndexPath</code> a bit more of a Ruby
interface.</p>

<h3>NSNotificationCenter</h3>

<p>Helper methods to give NSNotificationCenter a Ruby-like interface:</p>

<div class="highlight">
<pre><span class="k">def</span> <span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
  <span class="vi">@foreground_observer</span> <span class="o">=</span> <span class="n">notification_center</span><span class="o">.</span><span class="n">observe</span> <span class="no">UIApplicationWillEnterForegroundNotification</span> <span class="k">do</span> <span class="o">|</span><span class="n">notification</span><span class="o">|</span>
    <span class="n">loadAndRefresh</span>
  <span class="k">end</span>

  <span class="vi">@reload_observer</span> <span class="o">=</span> <span class="n">notification_center</span><span class="o">.</span><span class="n">observe</span> <span class="no">ReloadNotification</span> <span class="k">do</span> <span class="o">|</span><span class="n">notification</span><span class="o">|</span>
    <span class="n">loadAndRefresh</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">viewWillDisappear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
  <span class="n">notification_center</span><span class="o">.</span><span class="n">unobserve</span> <span class="vi">@foreground_observer</span>
  <span class="n">notification_center</span><span class="o">.</span><span class="n">unobserve</span> <span class="vi">@reload_observer</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">reload</span>
  <span class="n">notification_center</span><span class="o">.</span><span class="n">post</span> <span class="no">ReloadNotification</span>
<span class="k">end</span>
</pre>
</div>


<h3>NSUserDefaults</h3>

<p>Helper methods added to the class repsonsible for user preferences used
by the <code>App::Persistence</code> module shown below.</p>

<h3>Persistence</h3>

<p>Offers a way to persist application specific information using a very
simple interface:</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="c1"># application specific persistence storage</span>
<span class="c1"># ['NBC', 'ABC', 'Fox', 'CBS', 'PBS']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'TF1'</span><span class="p">,</span> <span class="s1">'France 2'</span><span class="p">,</span> <span class="s1">'France 3'</span><span class="o">]</span>
<span class="c1"># ['TF1', 'France 2', 'France 3']</span>
</pre>
</div>


<h3>Observers</h3>

<p><strong>Since: &gt; version 0.4</strong></p>

<p>You can observe for object's changes and trigger blocks:</p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nc">ExampleViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>
  <span class="kp">include</span> <span class="no">BW</span><span class="o">::</span><span class="no">KVO</span>

  <span class="k">def</span> <span class="nf">viewDidLoad</span>
    <span class="vi">@label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span> <span class="o">[[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="o">]</span><span class="p">,</span><span class="o">[</span><span class="mi">280</span><span class="p">,</span><span class="mi">44</span><span class="o">]]</span>
    <span class="vi">@label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span> <span class="vi">@label</span>

    <span class="n">observe</span><span class="p">(</span><span class="vi">@label</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"Hello from viewDidLoad!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
    <span class="n">observe</span><span class="p">(</span><span class="vi">@label</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"Hello from viewDidAppear!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre>
</div>


<h3>String</h3>

<p>The Ruby <code>String</code> class was extended to add <code>#camelize</code> and
<code>#underscore</code> methods.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="s2">"matt_aimonetti"</span><span class="o">.</span><span class="n">camelize</span>
<span class="o">=&gt;</span> <span class="s2">"MattAimonetti"</span>
<span class="o">&gt;</span> <span class="s2">"MattAimonetti"</span><span class="o">.</span><span class="n">underscore</span>
<span class="o">=&gt;</span> <span class="s2">"matt_aimonetti"</span>
</pre>
</div>


<h3>Time</h3>

<p>The <code>Time</code> Ruby class was added a class level method to convert a
iso8601 formatted string into a Time instance.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">iso8601</span><span class="p">(</span><span class="s2">"2012-05-31T19:41:33Z"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="mi">2012</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mi">31</span> <span class="mi">21</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">33</span> <span class="o">+</span><span class="mo">0200</span>
</pre>
</div>


<h3>UIControl / UIButton</h3>

<p>Helper methods to give <code>UIButton</code> a Ruby-like interface. Ex:</p>

<div class="highlight">
<pre><span class="n">button</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="no">UIControlEventTouchUpInside</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">redColor</span>
<span class="k">end</span>
</pre>
</div>


<h3>UIViewController</h3>

<p>A custom method was added to <code>UIViewController</code> to return the content
frame of a view controller.</p>

<h2>HTTP</h2>

<p><code>BubbleWrap::HTTP</code> wraps <code>NSURLRequest</code>, <code>NSURLConnection</code> and friends to provide Ruby developers with a more familiar and easier to use API.
The API uses async calls and blocks to stay as simple as possible.</p>

<p>To enable it add the following require line to your <code>Rakefile</code>:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/http'</span>
</pre>
</div>


<p>Usage example:</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://api.github.com/users/mattetti"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_str</span>
<span class="k">end</span>
</pre>
</div>


<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://api.github.com/users/mattetti"</span><span class="p">,</span> <span class="p">{</span><span class="n">credentials</span><span class="p">:</span> <span class="p">{</span><span class="n">username</span><span class="p">:</span> <span class="s1">'matt'</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="s1">'aimonetti'</span><span class="p">}})</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_str</span> <span class="c1"># prints the response's body</span>
<span class="k">end</span>
</pre>
</div>


<div class="highlight">
<pre><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">first_name</span><span class="p">:</span> <span class="s1">'Matt'</span><span class="p">,</span> <span class="n">last_name</span><span class="p">:</span> <span class="s1">'Aimonetti'</span><span class="p">}</span>
<span class="no">BubbleWrap</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"http://foo.bar.com/"</span><span class="p">,</span> <span class="p">{</span><span class="n">payload</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok?</span>
    <span class="n">json</span> <span class="o">=</span> <span class="no">BubbleWrap</span><span class="o">::</span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_str</span><span class="p">)</span>
    <span class="nb">p</span> <span class="n">json</span><span class="o">[</span><span class="s1">'id'</span><span class="o">]</span>
  <span class="k">elsif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="o">.</span><span class="n">to_s</span> <span class="o">=~</span> <span class="sr">/40\d/</span>
    <span class="no">App</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="s2">"Login failed"</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="no">App</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<h2>RSS Parser</h2>

<p><strong>Since: &gt; version 1.0.0</strong></p>

<p>The RSS Parser provides an easy interface to consume RSS feeds in an
asynchronous (non blocking) way.</p>

<div class="highlight">
<pre><span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"http://feeds2.feedburner.com/sdrbpodcast"</span><span class="p">)</span>
<span class="n">feed_parser</span><span class="o">.</span><span class="n">parse</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
  <span class="c1"># called asynchronously as items get parsed</span>
  <span class="nb">p</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
<span class="k">end</span>
</pre>
</div>


<p>The yielded RSS item is of type <code>RSSParser::RSSItem</code> and has the
following attributes:</p>

<ul>
<li>title</li>
<li>description</li>
<li>link</li>
<li>guid</li>
<li>pubDate</li>
<li>enclosure</li>
</ul>
<p>The item can be converted into a hash by calling <code>to_hash</code> on it.</p>

<h3>Delegate</h3>

<p><strong>Since: &gt; version 1.0.0</strong></p>

<p>You can also designate a delegate to the parser and implement change
state callbacks:</p>

<div class="highlight">
<pre><span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"http://feeds.feedburner.com/sdrbpodcast"</span><span class="p">)</span>
<span class="n">feed_parser</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>
<span class="n">feed</span><span class="o">.</span><span class="n">parse</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
<span class="k">end</span>

<span class="c1"># Delegate method</span>
<span class="k">def</span> <span class="nf">when_parser_initializes</span>
  <span class="nb">p</span> <span class="s2">"The parser is ready!"</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">when_parser_parses</span>
  <span class="nb">p</span> <span class="s2">"The parser started parsing the document"</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">when_parser_is_done</span>
  <span class="nb">p</span> <span class="s2">"The feed is entirely parsed, congratulations!"</span>
<span class="k">end</span>
</pre>
</div>


<p>These delegate methods are optional, however, you might find the
<code>when_parser_is_done</code> callback useful if you collected all the items and
want to process all at once for instance.</p>

<h3>Parsing a remote content or actual data</h3>

<p>You have the choice to initialize a parser instance with a string
representing an URL, an instance of <code>NSURL</code> or my specifying that the
passed param is some data to parse directly.</p>

<div class="highlight">
<pre><span class="c1"># string representing an url:</span>
<span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"http://feeds2.feedburner.com/sdrbpodcast"</span><span class="p">)</span>
<span class="c1"># a NSURL instance:</span>
<span class="n">url</span> <span class="o">=</span>  <span class="no">NSURL</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithString</span><span class="p">(</span><span class="s2">"http://matt.aimonetti.net/atom.xml"</span><span class="p">)</span>
<span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># Some data</span>
<span class="n">feed</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'atom.xml'</span><span class="p">)</span>
<span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
</pre>
</div>


<h2>Reactor</h2>

<p><strong>Since: &gt; version 1.0.0</strong></p>

<p><code>BubbleWrap::Reactor</code> is a simplified, mostly complete implementation of
the <a href="http://rubyeventmachine.com/">Event Machine</a> API.  In fact 
<code>BubbleWrap::Reactor</code> is aliased to <code>EM</code> in the runtime environment.</p>

<h3>Deferables</h3>

<p>BubbleWrap provides both a <code>Deferrable</code> mixin and a <code>DefaultDeferrable</code>
class, which simply mixes in deferrable behaviour if you don't want to
implement your own.</p>

<p>A deferrable is an object with four states: unknown, successful, failure
and timeout.  When you initially create a deferrable it is in an unknown
state, however you can assign callbacks to be run when the object
changes to either successful or failure state.</p>

<h4>Success</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::DefaultDeferrable:0x6d859a0&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span> <span class="o">|</span><span class="n">what</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Great </span><span class="si">#{</span><span class="n">what</span><span class="si">}</span><span class="s2">!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x6d8a1e0&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">succeed</span> <span class="s2">"justice"</span>
<span class="no">Great</span> <span class="n">justice!</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h4>Failure</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::DefaultDeferrable:0x8bf3ee0&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span> <span class="o">|</span><span class="n">what</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Great </span><span class="si">#{</span><span class="n">what</span><span class="si">}</span><span class="s2">!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x8bf3ef0&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">fail</span> <span class="s2">"sadness"</span>
<span class="no">Great</span> <span class="n">sadness!</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h4>Timeout</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::DefaultDeferrable:0x8bf5910&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Great scott!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x8bf6350&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">timeout</span> <span class="mi">2</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::Timer:0x6d920a0 @timer=#&lt;__NSCFTimer:0x6d91990&gt;&gt;</span>
<span class="c1"># wait...</span>
<span class="o">&gt;</span> <span class="no">Great</span> <span class="n">scott!</span>
</pre>
</div>


<h3>Timers</h3>

<p><em>All timers can be cancelled using <code>EM.cancel_timer</code>.</em></p>

<h4>One-shot timers</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">add_timer</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">do</span>
<span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"Great scott!"</span>
<span class="o">&gt;</span> <span class="k">end</span>
<span class="o">=&gt;</span> <span class="mi">146335904</span>
<span class="o">&gt;</span> <span class="no">Great</span> <span class="n">scott!</span>
</pre>
</div>


<h4>Periodic timers</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">=&gt;</span> <span class="mi">0</span>
<span class="o">&gt;</span> <span class="n">timer</span> <span class="o">=</span> <span class="no">EM</span><span class="o">.</span><span class="n">add_periodic_timer</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">do</span>
<span class="o">&gt;</span>   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"Great scott!"</span>
<span class="o">&gt;</span>   <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="no">EM</span><span class="o">.</span><span class="n">cancel_timer</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="k">end</span>
<span class="o">=&gt;</span> <span class="mi">146046832</span>
<span class="o">&gt;</span> <span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
</pre>
</div>


<h3>Scheduling operations</h3>

<p>You can use <code>EM.schedule</code> to schedule blocks to be executed 
asynchronously.  BubbleWrap deviates from the EventMachine
API here in that it also provides <code>EM.schedule_on_main</code> which
makes sure that the task is run asynchronously, but on the 
application's main thread - this is necessary if you are 
updating the user interface.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">schedule</span> <span class="p">{</span> <span class="nb">puts</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">object_id</span> <span class="p">}</span>
<span class="mi">146027920</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">schedule_on_main</span> <span class="p">{</span> <span class="nb">puts</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">object_id</span> <span class="p">}</span>
<span class="mi">112222480</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h3>Deferrable operations</h3>

<p>You can also use <code>EM.defer</code> in much the same way as <code>EM.schedule</code>
with one important difference, you can pass in a second <code>proc</code> 
which will be called when the first has completed, and be passed
it's result as an argument:</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">operation</span> <span class="o">=</span> <span class="nb">proc</span> <span class="p">{</span> <span class="mi">99</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Proc:0x6d763c0&gt;</span>
<span class="o">&gt;</span> <span class="n">callback</span> <span class="o">=</span> <span class="nb">proc</span> <span class="p">{</span> <span class="o">|</span><span class="n">speed</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">speed</span> <span class="o">&gt;=</span> <span class="mi">99</span> <span class="o">?</span> <span class="s2">"Time travel!"</span> <span class="p">:</span> <span class="s2">"Conventional travel!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Proc:0x8bd3910&gt;</span>
<span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="no">Time</span> <span class="n">travel!</span>
</pre>
</div>


<h3>Events</h3>

<p>Although not part of the EventMachine API, BubbleWrap provides
an <code>Eventable</code> mixin for use instrumenting objects with simple
event triggering behaviour. <code>BubbleWrap::Reactor</code> uses this
behind the scenes in several places, and as it's a very handy
idiom it is available as a public API.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">o</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="kp">include</span> <span class="no">EM</span><span class="o">::</span><span class="no">Eventable</span> <span class="p">}</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;#&lt;Class:0x6dc1310&gt;:0x6dc2ec0&gt;</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Ow!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x6dc6300&gt;]</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Flux capacitor!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x6dc6300&gt;, #&lt;Proc:0x6dc1ba0&gt;]</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span>
<span class="no">Ow</span><span class="o">!</span>
<span class="no">Flux</span> <span class="n">capacitor!</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="o">]</span>
</pre>
</div>


<h1>Suggestions?</h1>

<p>Do you have a suggestion for a specific wrapper? Feel free to open an
issue/ticket and tell us about what you are after. If you have a
wrapper/helper you are using and are thinking that others might enjoy,
please send a pull request (with tests if possible).</p>
</body></html>

       </section>
       <footer>
       <p>This project is maintained by:</p>
       <ul>
         <li><a href="https://github.com/mattetti"><img src="https://secure.gravatar.com/avatar/c69521d6e22fc0bbd69337ec8b1698df?s=24&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-24.png">Matt Aimonetti</a><a href="http://twitter.com/merbist"><small>@merbist</small></a></li>
         <li><a href="https://github.com/siuying"><img src="https://secure.gravatar.com/avatar/ecdf9a83234e21743d77b75fd308b929?s=24&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-24.png">Francis Chong</a><a href="http://twitter.com/siuying"><small>@siuying</small></a></li>
         <li><a href="https://github.com/mneorr"><img src="https://secure.gravatar.com/avatar/9ee164729035736549e4ae6e6e2d7cfc?s=24&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-24.png">Marin Usalj</a><a href="http://twitter.com/mneorr"><small>@mneorr</small></a></li>
         <li><a href="https://github.com/jamesotron"><img src="https://secure.gravatar.com/avatar/d468b182b11cdee834dd1f9777645b79?s=24&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-24.png">James Harton</a><a href="http://twitter.com/jamesotron"><small>@jamesotron</small></a></li>
         <li><a href="https://github.com/janweinkauff"><img src="https://secure.gravatar.com/avatar/89a1b3da3c51c9028598e4c703c6acbf?s=24&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-24.png">Jan Weinkauff</a><a href="http://twitter.com/janweinkauff"><small>@janweinkauff</small></a></li>
       </ul>
       </footer>
     </div>
     <script src="javascripts/scale.fix.js"></script>

   </body>
 </html>
